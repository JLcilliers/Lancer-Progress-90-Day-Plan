<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct API Test</title>
</head>
<body>
    <h1>Testing Direct Supabase API Access</h1>
    <button onclick="testDirectAPI()">Test Direct API</button>
    <button onclick="testWithCurl()">Show CURL Command</button>
    <pre id="output"></pre>

    <script>
        const SUPABASE_URL = 'https://fihlfqufsltgkxbgonxo.supabase.co';
        const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpaGxmcXVmc2x0Z2t4YmdvbnhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3ODA3NTMsImV4cCI6MjA3MTM1Njc1M30.NJP5ngR8Pl1b4l328fGbhCyTcxzzuGtrXF264YLlnxY';
        
        async function testDirectAPI() {
            const output = document.getElementById('output');
            output.textContent = 'Testing...\n\n';
            
            // Test 1: Check if API endpoint responds
            output.textContent += 'Test 1: Checking API endpoint...\n';
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    headers: {
                        'apikey': ANON_KEY,
                        'Authorization': `Bearer ${ANON_KEY}`
                    }
                });
                
                if (response.ok) {
                    const text = await response.text();
                    output.textContent += `✅ API responded with status ${response.status}\n`;
                    output.textContent += `Response: ${text}\n\n`;
                } else {
                    output.textContent += `❌ API returned status ${response.status}\n\n`;
                }
            } catch (error) {
                output.textContent += `❌ Failed to reach API: ${error.message}\n\n`;
            }
            
            // Test 2: Try to query the table
            output.textContent += 'Test 2: Querying table...\n';
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/lancer_seo_tasks?select=*&limit=1`, {
                    headers: {
                        'apikey': ANON_KEY,
                        'Authorization': `Bearer ${ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    output.textContent += `✅ Table query successful\n`;
                    output.textContent += `Data: ${JSON.stringify(data, null, 2)}\n\n`;
                } else {
                    const text = await response.text();
                    output.textContent += `❌ Table query failed with status ${response.status}\n`;
                    output.textContent += `Response: ${text}\n\n`;
                }
            } catch (error) {
                output.textContent += `❌ Failed to query table: ${error.message}\n\n`;
            }
            
            // Test 3: Check browser info
            output.textContent += 'Test 3: Browser Information...\n';
            output.textContent += `Browser: ${navigator.userAgent}\n`;
            output.textContent += `Protocol: ${window.location.protocol}\n`;
            output.textContent += `Host: ${window.location.host || 'Local File'}\n\n`;
            
            // Test 4: Check for blocking
            output.textContent += 'Test 4: Possible Issues...\n';
            if (window.location.protocol === 'file:') {
                output.textContent += '⚠️ Running from local file - may have CORS issues\n';
                output.textContent += 'Solution: Use a web server or access from GitHub Pages\n';
            }
            
            // Check for ad blockers or privacy extensions
            output.textContent += '\nPossible causes of connection failure:\n';
            output.textContent += '1. Browser extensions (ad blockers, privacy tools) blocking the connection\n';
            output.textContent += '2. Corporate firewall or VPN blocking Supabase\n';
            output.textContent += '3. Browser security settings\n';
            output.textContent += '4. DNS issues resolving fihlfqufsltgkxbgonxo.supabase.co\n';
        }
        
        function testWithCurl() {
            const output = document.getElementById('output');
            const curlCommand = `curl -X GET "${SUPABASE_URL}/rest/v1/lancer_seo_tasks?select=*&limit=1" \\
  -H "apikey: ${ANON_KEY}" \\
  -H "Authorization: Bearer ${ANON_KEY}"`;
            
            output.textContent = 'Test this command in your terminal:\n\n' + curlCommand;
            output.textContent += '\n\nIf this works in terminal but not in browser, it\'s a browser/network issue.';
        }
    </script>
</body>
</html>